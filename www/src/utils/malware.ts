import { PackageInfo, SuspiciousAppInfo } from '../types/types';

// parses base64-encoded malware data to SuspiciousAppInfo[]
export const parseMalwareData = async (
  data: string[],
): Promise<SuspiciousAppInfo[]> => {
  return new Promise((resolve, reject) => {
    try {
      resolve(data.map((entry) => toSuspiciousAppInfo(entry)));
    } catch (error) {
      reject(`Error while parsing app data: ${error}`);
    }
  });
};

const toSuspiciousAppInfo = (base64Value: string): SuspiciousAppInfo => {
  const data = JSON.parse(atob(base64Value));
  const packageInfo = data.packageInfo as PackageInfo;
  return {
    packageInfo,
    reason: data.reason,
    permissions: data.permissions,
  } as SuspiciousAppInfo;
};
